const boxListEl=document.getElementById("box-list"),cardsListEl=document.getElementById("cards_list"),cardsEl=document.getElementsByClassName("card-item"),formEl=document.getElementById("form"),loginEl=document.getElementById("login"),passEl=document.getElementById("password"),logBtnEl=document.getElementById("loginBtn"),firstNameEl=document.getElementById("firstName"),lastNameEl=document.getElementById("lastName"),avatarEl=document.getElementById("avatar"),formBtnEl=document.getElementById("formBtn"),arrorInfo=document.getElementById("arror-info"),prevBtnEl=document.getElementById("prevBtn"),nextBtnEl=document.getElementById("nextBtn"),changeBtnEl=document.getElementsByClassName("changeBtn"),delBtnEl=document.getElementsByClassName("delBtn"),requestUrl="https://reqres.in/api/users";let paginator=1;function validLogin(e){return/\S+@\S+\.\S+/.test(e)}function checkInputValue(e,t){t?(e.parentElement.classList.add("arror"),e.classList.add("is-arror"),e.value=""):(e.parentElement.classList.remove("arror"),e.classList.remove("is-arror"))}function checkBtn(e,t){e.value&&t.value?logBtnEl.classList.replace("is-disabled","is-success"):logBtnEl.classList.replace("is-success","is-disabled")}function authPostRequest(e){fetch(e,{method:"POST",body:JSON.stringify({email:""+loginEl.value,password:""+passEl.value}),headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>{"QpwL5tke4Pnpja7X4"==(e=e.token)?(arrorInfo.classList.add("arror--show"),arrorInfo.innerText="Authorization is successful",setTimeout(()=>{formEl.style.display="none",passEl.style.display="none",arrorInfo.classList.remove("arror--show"),boxListEl.style.display="block"},2e3)):(arrorInfo.classList.add("arror--show"),arrorInfo.innerText="Incorrect info!! Try again")})}function sentRequest(e,l){newUrl=new URL(e),newUrl.searchParams.set("page",""+paginator),fetch(newUrl).then(e=>e.json()).then(t=>{t=t.data;for(let e=0;e<t.length;e++)l[e].data=""+t[e].id,l[e].innerHTML=`
            <img src='${t[e].avatar}' style="display: block" alt="user avatar" widht="100%" >
            <span class="userInfo">${t[e].first_name} ${t[e].last_name}</span>
            <p class="userEmail">Write me: ${t[e].email}</p>`})}function patchRequest(e,n){fetch(e,{method:"PATCH",body:JSON.stringify({email:""+loginEl.value,first_name:""+firstNameEl.value,last_name:""+lastNameEl.value}),headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>{console.log(e),console.log(e.first_name),console.log(e.last_name);const t=document.getElementsByClassName("userInfo"),l=document.getElementsByClassName("userEmail");t[n].innerText=e.first_name+" "+e.last_name,l[n].innerText="Write me: "+e.email})}function changeUser(e,t){newUrl=new URL(e),newUrl.searchParams.set("page",""+paginator),fetch(newUrl).then(e=>e.json()).then(e=>{e=e.data,loginEl.value=""+e[t].email,firstNameEl.value=""+e[t].first_name,lastNameEl.value=""+e[t].last_name,cardsEl[t].id=e[t].id,formBtnEl.addEventListener("click",()=>{patchRequest("https://reqres.in/api/users/"+e[t].id,t),setTimeout(()=>{formEl.style.display="none",formBtnEl.style.display="none"},1e3)},{once:!0})})}function deleteRequest(e,t,l){fetch(e,{method:"DELETE",body:JSON.stringify({email:""+l[t].email,first_name:""+l[t].first_name,last_name:""+l[t].last_name}),headers:{"content-type":"application/json"}})}function deleteUser(e,l){newUrl=new URL(e),newUrl.searchParams.set("page",""+paginator),fetch(newUrl).then(e=>e.json()).then(t=>{deleteRequest("https://reqres.in/api/users/"+(t=t.data)[l].id,l,t);for(let e=0;e<cardsEl.length;e++)cardsEl[e].data==t[l].id&&(cardsEl[e].style.display="none",changeBtnEl[e].style.display="none",delBtnEl[e].style.display="none")})}(()=>{loginEl.addEventListener("focusout",()=>{checkInputValue(loginEl,!validLogin(loginEl.value)),checkBtn(loginEl,passEl)}),passEl.addEventListener("focusout",()=>{checkInputValue(passEl,!passEl.value),checkBtn(loginEl,passEl)}),formEl.addEventListener("submit",e=>{e.preventDefault(),loginEl.value&&passEl.value?authPostRequest("https://reqres.in/api/login"):(checkInputValue(loginEl,!validLogin(loginEl.value)),checkInputValue(passEl,!passEl.value),passEl.value="")}),sentRequest(requestUrl,cardsEl),prevBtnEl.addEventListener("click",()=>{1<paginator?--paginator:paginator,sentRequest(requestUrl,cardsEl),console.log("pressed prev_btn");for(let e=0;e<cardsEl.length;e++)cardsEl[e].style.display="block",changeBtnEl[e].style.display="inline-flex",delBtnEl[e].style.display="inline-flex";formEl.style.display="none",formBtnEl.style.display="none"}),nextBtnEl.addEventListener("click",()=>{paginator<2?++paginator:paginator,sentRequest(requestUrl,cardsEl),console.log("pressed next_btn");for(let e=0;e<cardsEl.length;e++)cardsEl[e].style.display="block",changeBtnEl[e].style.display="inline-flex",delBtnEl[e].style.display="inline-flex";formEl.style.display="none",formBtnEl.style.display="none"});for(let e=0;e<changeBtnEl.length;e++)changeBtnEl[e].addEventListener("click",()=>{confirm("Do you really want to correct info?")&&(formEl.style.display="block",firstNameEl.parentElement.style.display="block",lastNameEl.parentElement.style.display="block",loginBtn.style.display="none",formBtnEl.style.display="block",changeUser(requestUrl,e))});for(let e=0;e<delBtnEl.length;e++)delBtnEl[e].addEventListener("click",()=>{console.log("pressed delBtnEl"),formEl.style.display="none",formBtnEl.style.display="none",confirm("Do you really want to delete profile?")&&deleteUser(requestUrl,e)})})();